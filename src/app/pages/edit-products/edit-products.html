<div class="container py-5">

  <div class="card shadow-lg border-0 admin-card">

    <!-- ================= HEADER ================= -->
    <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">

      <div>
        <h5 class="mb-0 fw-semibold">üõ† Administrar productos</h5>
        <small class="opacity-75">{{ products.length }} productos registrados</small>
      </div>

      <input
        type="text"
        class="form-control form-search w-auto"
        placeholder="Buscar producto..."
        [(ngModel)]="searchTerm"
        (ngModelChange)="search = $event"
      />

    </div>


    <!-- ================= TABLE ================= -->
    <div class="table-responsive">

      <table class="table align-middle table-hover mb-0">

        <thead class="table-light">
          <tr>
            <th style="width:70px"></th>
            <th>Producto</th>
            <th>Precio</th>
            <th>Stock</th>
            <th class="text-end">Acciones</th>
          </tr>
        </thead>

        <tbody>

          <tr
            *ngFor="let product of filteredProducts; trackBy: trackById"
            class="row-hover"
          >

            <td>
              <img
                [src]="product.image || 'https://via.placeholder.com/60'"
                class="product-thumb"
              />
            </td>

            <td class="fw-semibold">
              {{ product.name }}
            </td>

            <td class="text-success fw-bold">
              ${{ product.price }}
            </td>

            <td>
              <span class="badge bg-success">
                {{ product.stock }}
              </span>
            </td>

            <td class="text-end">

              <button
                class="btn btn-primary btn-sm rounded-pill me-2"
                (click)="edit(product)"
              >
                ‚úèÔ∏è Editar
              </button>

              <button
                class="btn btn-outline-danger btn-sm rounded-pill"
                (click)="delete(product._id!)"
              >
                üóë Eliminar
              </button>

            </td>

          </tr>

        </tbody>

      </table>

    </div>

  </div>


  <!-- ================= MODAL EDITAR (NUEVO PRO) ================= -->
  @if (selectedProduct) {

    <div class="modal-backdrop-custom">

      <div class="edit-modal shadow-lg">

        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">‚úèÔ∏è Editar producto</h5>

          <button class="btn-close" (click)="selectedProduct = null"></button>
        </div>

        <img
          [src]="selectedProduct.image || 'https://via.placeholder.com/120'"
          class="modal-img mb-3"
        />

        <input
          class="form-control mb-2"
          [(ngModel)]="selectedProduct.name"
          placeholder="Nombre"
        />

        <input
          type="number"
          class="form-control mb-2"
          [(ngModel)]="selectedProduct.price"
          placeholder="Precio"
        />

        <input
          type="number"
          class="form-control mb-3"
          [(ngModel)]="selectedProduct.stock"
          placeholder="Stock"
        />

        <div class="text-end">
          <button class="btn btn-secondary me-2"
                  (click)="selectedProduct = null">
            Cancelar
          </button>

          <button class="btn btn-success"
                  (click)="save()">
            Guardar cambios
          </button>
        </div>

      </div>

    </div>
  }

</div>



<!-- ================= ESTILOS BONITOS ================= -->
<style>
.admin-card {
  border-radius: 20px;
}

.product-thumb {
  width: 55px;
  height: 55px;
  object-fit: cover;
  border-radius: 10px;
}

.row-hover:hover {
  background-color: #f6f6f6;
  transition: 0.2s;
}

.form-search {
  border-radius: 999px;
  padding: 6px 14px;
}


/* üî• MODAL */
.modal-backdrop-custom {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.45);
  backdrop-filter: blur(3px);

  display: flex;
  align-items: center;
  justify-content: center;

  z-index: 999;
}

.edit-modal {
  width: 380px;
  background: white;
  padding: 25px;
  border-radius: 18px;
  animation: pop 0.18s ease;
}

.modal-img {
  width: 100%;
  height: 120px;
  object-fit: cover;
  border-radius: 12px;
}

@keyframes pop {
  from {
    transform: scale(.9);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}
</style>
